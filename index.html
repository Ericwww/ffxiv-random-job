<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FF14 éšæœºèŒä¸šåŠ©æ‰‹ - Icons Edition</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        :root { --bg: #23272a; --card-bg: #2c2f33; --accent: #7289da; --t-color: #3498db; --h-color: #2ecc71; --d-color: #e74c3c; }
        body { font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; background: var(--bg); color: #dcddde; max-width: 800px; margin: 0 auto; padding: 20px; }
        .card { background: var(--card-bg); border-radius: 8px; padding: 15px; margin-bottom: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        
        /* ç»“æœå±•ç¤º */
        .result-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 10px; margin-top: 15px; }
        .result-card { background: #36393f; padding: 10px; border-radius: 6px; display: flex; align-items: center; border-left: 4px solid #fff; }
        .res-t { border-color: var(--t-color); } .res-h { border-color: var(--h-color); } .res-d { border-color: var(--d-color); }

        /* å›¾æ ‡æ ·å¼ */
        .job-icon { width: 24px; height: 24px; vertical-align: middle; margin-right: 5px; border-radius: 3px; }
        .job-icon.large { width: 32px; height: 32px; }

        /* å‹¾é€‰æ¡†æ ·å¼ */
        .job-tag { display: inline-flex; align-items: center; padding: 4px 8px; margin: 3px; background: #4f545c; border-radius: 4px; cursor: pointer; font-size: 13px; user-select: none; transition: 0.2s; }
        .job-tag:hover { background: #5d6269; }
        .job-tag.active { background: var(--accent); color: white; box-shadow: inset 0 0 5px rgba(0,0,0,0.2); }
        .job-tag.active.t-bg { background: var(--t-color); }
        .job-tag.active.h-bg { background: var(--h-color); }
        .job-tag.active.d-bg { background: var(--d-color); }

        .role-btn { cursor: pointer; font-weight: bold; text-decoration: underline; margin-right: 10px; min-width: 50px; display: inline-block; }
        input[type="text"] { background: #202225; border: 1px solid #444; color: white; padding: 8px; border-radius: 4px; width: 200px; }
        .btn-main { background: #43b581; color: white; border: none; padding: 12px 20px; border-radius: 5px; width: 100%; font-size: 1.1em; cursor: pointer; font-weight: bold; }
        .btn-main:hover { background: #3ca374; }
    </style>
</head>
<body>

<div id="app">
    <h2>âœ¨ FF14 äº²å‹éšäººéšèŒåŠ©æ‰‹</h2>

    <div class="card">
        <div style="margin-bottom: 15px;">
            <label>å½“å‰é˜µå®¹ï¼š</label>
            <select v-model="selectedComp" style="padding: 8px; background: #2f3136; color: white; border: 1px solid #444;">
                <option v-for="c in compositions" :value="c.value">{{ c.label }}</option>
            </select>
        </div>
        <button class="btn-main" @click="generate">ğŸ² æ³¨å…¥çµé­‚ï¼ˆå¼€å§‹ç”Ÿæˆï¼‰</button>
    </div>

    <div v-if="results.length" class="card" style="border: 2px solid #43b581;">
        <h3 style="margin-top:0; color: #43b581;">åˆ†é…å®Œæ¯•ï¼</h3>
        <div class="result-grid">
            <div v-for="res in results" :class="['result-card', 'res-'+res.role.toLowerCase()]">
                <img :src="getIcon(res.job)" class="job-icon large">
                <div>
                    <div style="font-size: 0.8em; color: #aaa;">{{ res.playerName }}</div>
                    <div style="font-weight: bold;">{{ res.job }}</div>
                </div>
            </div>
        </div>
    </div>

    <div style="display:flex; justify-content: space-between; align-items: center;">
        <h3>å°é˜Ÿæˆå‘˜ ({{ players.length }})</h3>
        <button @click="addPlayer" style="background:var(--accent); color:white; border:none; padding:5px 15px; border-radius:4px; cursor:pointer;">+ æ·»åŠ äº²å‹</button>
    </div>

    <div v-for="(player, pIdx) in players" :key="pIdx" class="card">
        <div style="display:flex; justify-content: space-between; margin-bottom: 15px;">
            <input type="text" v-model="player.name" placeholder="è§’è‰²ID">
            <button @click="removePlayer(pIdx)" style="background:none; border:none; color:#ff4757; cursor:pointer;">åˆ é™¤</button>
        </div>

        <div v-for="(jobs, role) in allJobs" :key="role" style="margin-bottom: 10px; display: flex;">
            <span class="role-btn" @click="toggleRole(pIdx, role)">{{ roleName(role) }}</span>
            <div style="flex: 1;">
                <span v-for="job in jobs" 
                      :class="['job-tag', player.selectedJobs.includes(job) ? 'active ' + role.toLowerCase() + '-bg' : '']"
                      @click="toggleJob(pIdx, job)">
                    <img :src="getIcon(job)" class="job-icon"> {{ job }}
                </span>
            </div>
        </div>
    </div>
</div>

<script>
const { createApp } = Vue;

// èŒä¸šå›¾æ ‡æ˜ å°„ï¼ˆåˆ©ç”¨ç°æœºWikiç­‰CDNï¼Œè¿™é‡Œä½¿ç”¨ç®€å†™å¯¹åº”å…¶å›¾ç‰‡åï¼‰
// æç¤ºï¼šå¦‚æœå›¾æ ‡å¤±æ•ˆï¼Œå¯æ›¿æ¢ä¸ºå…¶ä»–FF14å›¾åºŠ
const JOB_MAP = {
    'éª‘å£«':'Paladin','æˆ˜å£«':'Warrior','æš—é»‘éª‘å£«':'Dark_Knight','ç»æªæˆ˜å£«':'Gunbreaker',
    'ç™½é­”æ³•å¸ˆ':'White_Mage','å­¦è€…':'Scholar','å æ˜Ÿæœ¯å£«':'Astrologian','è´¤è€…':'Sage',
    'æ­¦å£«':'Samurai','é¾™éª‘å£«':'Dragoon','å¿è€…':'Ninja','é’é•°å®¢':'Reaper','è›‡æ­¦å£«':'Viper',
    'é»‘é­”æ³•å¸ˆ':'Black_Mage','å¬å”¤å¸ˆ':'Summoner','èµ¤é­”æ³•å¸ˆ':'Red_Mage','ç»˜é­”å¸ˆ':'Pictomancer',
    'è¯—äºº':'Bard','æœºå·¥å£«':'Machinist','èˆè€…':'Dancer'
};

createApp({
    data() {
        return {
            allJobs: {
                T: ['éª‘å£«', 'æˆ˜å£«', 'æš—é»‘éª‘å£«', 'ç»æªæˆ˜å£«'],
                H: ['ç™½é­”æ³•å¸ˆ', 'å­¦è€…', 'å æ˜Ÿæœ¯å£«', 'è´¤è€…'],
                D: ['æ­¦å£«', 'é¾™éª‘å£«', 'å¿è€…', 'é’é•°å®¢', 'è›‡æ­¦å£«', 'é»‘é­”æ³•å¸ˆ', 'å¬å”¤å¸ˆ', 'èµ¤é­”æ³•å¸ˆ', 'ç»˜é­”å¸ˆ', 'è¯—äºº', 'æœºå·¥å£«', 'èˆè€…']
            },
            compositions: [
                { label: '4äººè½»é” (1T 1H 2D)', value: 'THDD' },
                { label: '8äººæ»¡ç¼– (2T 2H 4D)', value: 'TTHHDDDD' },
                { label: 'ææ€ª (1T 3D)', value: 'TDDD' },
                { label: 'ææ€ª (1H 3D)', value: 'HDDD' },
                { label: 'æ·±å±‚è¿·å®« (4D)', value: 'DDDD' },
                { label: 'è®¨ä¼æˆ˜ (1T 2H 5D)', value: 'THHDDDDD' }
            ],
            selectedComp: 'THDD',
            players: [],
            results: []
        }
    },
    mounted() {
        const saved = localStorage.getItem('ff14_roller_v3');
        if (saved) this.players = JSON.parse(saved);
        else for(let i=0; i<4; i++) this.addPlayer();
    },
    methods: {
        getIcon(jobName) {
            const enName = JOB_MAP[jobName] || 'Unknown';
            // ä½¿ç”¨ä¸€ä¸ªç¨³å®šçš„FF14å›¾æ ‡æºï¼ˆè¿™é‡Œå€Ÿç”¨ç°æœºWikiçš„è·¯å¾„é€»è¾‘ï¼Œå®é™…éƒ¨ç½²å»ºè®®ä¸‹è½½å›¾æ ‡åˆ°æœ¬åœ°ä»“åº“ï¼‰
            return `https://ff14.huijiwiki.com/wiki/Special:FilePath/01-Job-${enName.replace('_',' ')}.png`;
        },
        roleName(r) { return {T:'é˜²æŠ¤', H:'æ²»ç–—', D:'è¾“å‡º'}[r]; },
        addPlayer() {
            this.players.push({
                name: 'å†’é™©è€…' + (this.players.length + 1),
                selectedJobs: [...this.allJobs.T, ...this.allJobs.H, ...this.allJobs.D]
            });
            this.save();
        },
        removePlayer(idx) {
            this.players.splice(idx, 1);
            this.save();
        },
        toggleJob(pIdx, job) {
            const list = this.players[pIdx].selectedJobs;
            const index = list.indexOf(job);
            if (index > -1) list.splice(index, 1);
            else list.push(job);
            this.save();
        },
        toggleRole(pIdx, role) {
            const roleJobs = this.allJobs[role];
            const pJobs = this.players[pIdx].selectedJobs;
            const hasAll = roleJobs.every(j => pJobs.includes(j));
            if (hasAll) this.players[pIdx].selectedJobs = pJobs.filter(j => !roleJobs.includes(j));
            else roleJobs.forEach(j => { if (!pJobs.includes(j)) pJobs.push(j); });
            this.save();
        },
        save() { localStorage.setItem('ff14_roller_v3', JSON.stringify(this.players)); },
        generate() {
            const rolesNeeded = this.selectedComp.split('');
            if (rolesNeeded.length !== this.players.length) {
                alert(`äººæ•°ä¸ç¬¦ï¼é˜µå®¹éœ€è¦ ${rolesNeeded.length} äººï¼Œå½“å‰ ${this.players.length} äººã€‚`);
                return;
            }
            const shuffledPlayers = [...this.players].sort(() => Math.random() - 0.5);
            let finalMap = [];
            const backtrack = (idx, currentAlloc) => {
                if (idx === rolesNeeded.length) { finalMap = currentAlloc; return true; }
                const roleNeeded = rolesNeeded[idx];
                const player = shuffledPlayers[idx];
                let possibleJobs = player.selectedJobs.filter(j => this.allJobs[roleNeeded].includes(j));
                possibleJobs.sort(() => Math.random() - 0.5);
                for (let job of possibleJobs) {
                    if (backtrack(idx + 1, [...currentAlloc, { playerName: player.name, job, role: roleNeeded }])) return true;
                }
                return false;
            };
            if (backtrack(0, [])) {
                this.results = finalMap;
                window.scrollTo({ top: 0, behavior: 'smooth' });
            } else {
                alert("æ— è§£ï¼è¯·æ£€æŸ¥æ˜¯å¦æœ‰äººèŒä¸šé€‰å¤ªå°‘äº†å¯¼è‡´å†²çªã€‚");
            }
        }
    }
}).mount('#app');
</script>
</body>
</html>
